<layout name="layout_admin" />
<div class="row">
    <div class="col-md-11">
        <form id="edit_scroll_form" action="/Admin/Module/editScroll" method="post" class="form-horizontal">
            <input type="hidden" name="cityId" value="{$cityId}" />
            <input type="hidden" name="parentModuleId" value="{$parentModuleId}" />
            <div class="form-group">
                <label class="col-sm-2 control-label">平台活动:
                    <?php if(!empty($platAct)):?><br /><a href="javascript:void(0);" class="check_all" act="platActivityCode">全选/取消</a><?php endif;?>
                </label>
                <div class="col-sm-2">
                    <foreach name="platAct" item="item">
                        <label class="checkbox-inline">
                            <input type="checkbox" name="platActivityCode[]" value="{$item.activityCode}" <foreach name="subModuleList" item="act"><eq name="act.activityCode" value="$item.activityCode">checked="checked"</eq></foreach>> {$item.activityName} <span class="text-danger"><if condition="$item.status eq 0">(禁用)<else /><?php if(strtotime($item['endTime']) < time()):?>(已过期)<?php endif;?></if></span>
                        </label>
                    </foreach>
                    <label class="checkbox-inline"><?php if(empty($platAct)):?>暂无<br /><?php endif;?>(<a href="/Admin/Activity/editActivity" class="external">添加</a>)</label>
                </div>

                <label class="col-sm-2 control-label">工行活动:
                    <?php if(!empty($bankAct)):?><br /><a href="javascript:void(0);" class="check_all" act="bankActivityCode">全选/取消</a><?php endif;?>
                </label>
                <div class="col-sm-2">
                    <foreach name="bankAct" item="item">
                        <label class="checkbox-inline">
                            <input type="checkbox" name="bankActivityCode[]" value="{$item.activityCode}" <foreach name="subModuleList" item="act"><eq name="act.activityCode" value="$item.activityCode">checked="checked"</eq></foreach>> {$item.activityName} <span class="text-danger"><if condition="$item.status eq 0">(禁用)<else /><?php if(strtotime($item['endTime']) < time()):?>(已过期)<?php endif;?></if></span>
                        </label>
                    </foreach>
                    <label class="checkbox-inline"><?php if(empty($bankAct)):?>暂无<br /><?php endif;?>(<a href="/Admin/Activity/editActivity" class="external">添加</a>)</label>
                </div>

                <label class="col-sm-2 control-label">商家活动:
                    <?php if(!empty($shopAct)):?><br /><a href="javascript:void(0);" class="check_all" act="shopActivityCode">全选/取消</a><?php endif;?>
                </label>
                <div class="col-sm-2">
                    <foreach name="shopAct" item="item">
                        <label class="checkbox-inline">
                            <input type="checkbox" name="shopActivityCode[]" value="{$item.activityCode}" <foreach name="subModuleList" item="act"><eq name="act.activityCode" value="$item.activityCode">checked="checked"</eq></foreach>> {$item.activityName} (<strong>{$item.shopName}</strong>) <span class="text-danger"><if condition="$item.status eq 0">(禁用)<else /><?php if(strtotime($item['endTime']) < time()):?>(已过期)<?php endif;?></if></span>
                        </label>
                    </foreach>
                    <label class="checkbox-inline"><?php if(empty($shopAct)):?>暂无<br /><?php endif;?>(<a href="/Admin/Activity/editActivity" class="external">添加</a>)</label>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-5 col-sm-7">
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </div>
        </form>
    </div>
</div>
<style>
    .checkbox-inline{margin-left: 0!important;display: block;}
    .text-danger{color: #d2322d;}
</style>
<script type="text/javascript">
    $(function(){
        $('#edit_scroll_form').on('submit', function() {
            $('button[type="submit"]').attr('disabled', true);
            var frm = $(this);
            $.post(frm.attr('action'), frm.serialize(), function(resp) {
                if (resp.status == sz.STATUS_SUCC) {
                    sz.showSuccMsg(resp.msg, 3);
                    location.href = '/Admin/District/listCityIndexModule?id={$cityId}';
                } else {
                    sz.showErrMsg(resp.msg, 3);
                    $('button[type="submit"]').attr('disabled', false);
                }
            });
            return false;
        });

        $('.check_all').click(function(){
            var name = $(this).attr('act');
            var obj = $('input[name="'+name+'[]"]');
            if(obj.prop('checked')==true){
                obj.removeAttr('checked');
            }else{
                obj.prop('checked',true);
            }
        });

    });
</script>