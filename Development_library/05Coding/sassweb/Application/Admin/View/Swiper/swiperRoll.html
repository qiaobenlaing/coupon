<layout name="layout_admin" />
<script src="__PUBLIC__/js/knockout.js" charset="UTF-8"></script>
<script src="__PUBLIC__/js/webuploader.js" charset="UTF-8"></script>
<script src="__PUBLIC__/js/upload.js" charset="UTF-8"></script>
<script src="__PUBLIC__/shop/set.js" charset="UTF-8"></script>
<link rel="stylesheet" href="__PUBLIC__/shop/set.css">
<body>
<div class="container-fluid">
    <div class="row">
        <include file="./Application/Admin/View/Shop/editShopMenuWidget.html"/>
        <div class="col-md-12">
            <form class="form-inline" id="data_search_form" action="/Admin/Swiper/swiperRoll" method="get">
                <div class="form-group">
                    <label for="search-province">省份</label>
                    <input type="hidden" value="{$get.name}" id="search-province"/>
                    <select class="form-control frm-select" name="name" id='province'>
                        <option value="">全部省份</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="city"><span class='required-ele'>*</span>城市/区域</label>
                    <input type="hidden" value="{$get.city}" id="search-city"/>
                    <select class="form-control frm-select" name='city' id='city'>
                        <option value="">请选择城市</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bank_id"><span class='required-ele'>*</span>商圈</label>
                    <input type="hidden" value="{$get.bank_id}" id="search-bank"/>
                    <select class="form-control frm-select" name='bank_id' id='bank_id'>
                        <volist name="BankList" id="vo">
                            <option value="{$vo['id']}" {:isCheck($vo['id'],$get['bank_id'],'selected')}>{$vo['name']}</option>
                        </volist>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary btn-sm" id="search_form_submit_btn">查询</button>
            </form>

                <form role="form" id="frm_edit_shop" action="/Admin/Swiper/swiperRoll" method="post" class="form-horizontal">
                    <input type="hidden" name="current-province" value="{$get.name}" id="current-province"/>
                    <input type="hidden" name="current-city" value="{$get.city}" id="current-city"/>
                    <input type="hidden" name="bank_id" value="{$get.bank_id}"/>
                    <div class="container-fluid">
                        <div class="row" style="margin: 10px 0px;border: 1px solid #000;border-radius: 4px;">
                            <div class="col-xs-12 shop-decoration-wrap">
                                <div class="col-md-12" style="font-size: 20px;margin-bottom: 10px">
                                    轮播图片（可一次选择多张上传）
                                    <a href="#" class="btn btn-danger btn-xs ready-to-del-decoration">删除</a>
                                    <a href="#" class="btn btn-warning btn-xs cancel-del-decoration">取消删除</a>
                                </div>
                                <div id="shop-decoration-wrap">
                                    <foreach name="dataList" item="item" >
                                        <div class="col-md-3 decoration-wrap" id="decoration-wrap-{$item.decorationCode}">
                                            <div class="del-shop-decoration"></div>
                                            <img src="{$item.url|default='__PUBLIC__/img/upload.png'}" class="img-responsive img-rounded decoration-img">

                                            <input type="hidden" class="form-control" name="imgUrl[]" value="{$item.url}" />
                                            <div class="form-group">
                                                <label>活动名称</label>
                                                <input type="text" class="form-control" name="title[]" value="{$item.title}" placeholder="活动名称"/>
                                            </div>
                                            <div class="form-group">
                                                <label>活动网址</label>
                                                <textarea class="form-control decoration-short-des" name="activityWeb[]" rows="4" placeholder="活动网址">{$item.activityWeb}</textarea>
                                            </div>
                                        </div>
                                    </foreach>
                                </div>
                                <div class="row-fluid employee-item-img">
                                    <div class="employee-item-imgdiv">
                                        <img name="business_card" src="__PUBLIC__/img/upload.png" class="J_business_card img-responsive img-rounded">
                                    </div>
                                    <div class="swiper-decoration-picker" id="forbide"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary btn-block" id="submit">保存</button>
                            </div>
                        </div>
                    </div>
                </form>

        </div>
    </div>
</div>
<!--add_album_Modal-->

<!--<script src="http://api.map.baidu.com/api?v=1.5&ak=mG5hg7F9fN7u8gZWTLGNlBRg" type="text/javascript"></script>-->
<script src="http://api.map.baidu.com/api?v=1.5&ak=BpGriR9K48MyUr933ecTuxmS" type="text/javascript"></script>
<div id="container"></div>
<script type="text/javascript">
// 返回提示页面显示的信息
;(function(){
    window.onbeforeunload = function() {
//        return "是否离开当前页面";
};
})();

//点击查询后显示轮播图
$("#forbide").click(function () {
        var province    = $("#province").val();
        var city        = $("#city").val();
        var bank_id     = $("#bank_id").val();
        //判断省份，城市，商圈是否选择
        if(!province || !city && !bank_id){
            $("#forbide input[type='file']").attr("disabled","true");
             sz.showErrMsg('请先查询所属商圈的城市是否存在轮播图', 4);
            return ;
        }
});


// 删除城市轮播图片相关
;(function(){
    // 预备删除城市轮播图
    $('.ready-to-del-decoration').on('click', function(){
        var html = '<a class="btn btn-danger btn-xs del-shop-decoration-btn">删除</a>';
        $('.del-shop-decoration').html(html).show();
        $('.del-shop-decoration-btn').on('click', function(){
            var btn = $(this);
            btn.parent().parent().remove();
            return false;
        });
        $(this).hide();
        $('.cancel-del-decoration').show();
        return false;
    });
    // 取消删除城市轮播图
    $('.cancel-del-decoration').on('click', function(){
        $('.del-shop-decoration').empty().hide();
        $(this).hide();
        $('.ready-to-del-decoration').show();
        return false;
    });
})();


$(function() {

    // 初始化省份、城市、地区
    var defaultProvince = $('#search-province').val();
    var defaultCity = $('#search-city').val();
    // var defaultDistrict = $('#search-district').val();
    console.log(defaultProvince + defaultCity);
    sz.initDistrict(defaultProvince, defaultCity);

    // 省市改变后搜索轮播图
    $('.searchSwiper').click(function(){
        var province = $('#province').val();
        var city = $('#city').val();
        if(! province) {
            sz.showErrMsg('请选择省', 4);
            // province = $('#search-province').val();
        }
        if(! city) {
            sz.showErrMsg('请选择城市', 4);
            // city = $('#search-city').val();
        }else{
            $.post('/Admin/Shop/getBigMngInfo', {'city' : city}, function(resp) {
             //   console.log(resp);
            // if(resp.data) {
            //     $('.bigMngRealName').text(resp.data.realName);
            //     $('.bigMngMobileNbr').text(resp.data.mobileNbr);
            //     $('#big-mng-code').val(resp.data.staffCode);
            // } else {
            //     $('.bigMngRealName').text('');
            //     $('.bigMngMobileNbr').text('');
            //     $('#big-mng-code').val('');
            // }
        });
        }

    });

// 表单提交
$('#frm_edit_shop').on('submit', function() {

    //设置所属商圈
        var bank_id =  $("#bank_id option:selected").val();
      $("#bank_id1").val(bank_id);

    var subBtn = $('#submit');
    subBtn.attr('disabled', 'disabled');
    var frm = $(this);
      $.post(frm.attr('action'), frm.serialize(), function(resp) {
       if (resp.status == sz.STATUS_SUCC) {
           // location.href = '/Admin/Swiper/swiperRoll?name=' + resp.data.name;
           sz.showSuccMsg(resp.msg, 3);
       } else {
         sz.showErrMsg(resp.msg, 3);
     }
      subBtn.attr('disabled', false);
 });
      return false;
  });

});
</script>
<!-- <div id="data_table_wrapper">
    <include file="./Application/Admin/View/Swiper/listSwiperWidget.html" />
</div> -->