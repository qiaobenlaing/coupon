<layout name="layout_api" />
<!-- Views -->
<div class="views">
    <!-- Your main view, should have "view-main" class -->
    <div class="view view-main">
        <!-- Pages container, because we use fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages toolbar-through">
            <!-- Page, "data-page" contains page name -->
            <div data-page="index" class="page">
                <div class="navbar">
                    <div class="navbar-inner">
                        <div class="left"><a href="javascript:history.go(-1);" class="external"><img src="/Public/img/icon/backup.png" /></a></div>
                        <div class="center">{$title}</div>
                        <div class="right">&nbsp;</div>
                    </div>
                </div>

                <!-- Scrollable page content -->
                <div class="page-content" style="margin-top: 44px;text-align: center;background-color: rgb(149,126,255);">
                    <div class="page_view">
                        <img src="/Public/img/game/open_log_title.png" />
                        <p class="intro">
                            当前已有{$userGiftInfo.openNbr|default=0}位好友帮你拆开了礼盒，
                            <?php $c = intval($prizeRule['convertNbr']) - intval($userGiftInfo['openNbr']);?>
                            <?php if($c > 0):?>
                            还差<?php echo $c;?>名就可以免费吃大餐啦！
                            <?php else:?>
                            <?php if(empty($userGiftInfo['userGiftCode'])):?>
                            今天的礼品已经发完了，请明天再来！
                            <?php else:?>
                            礼品{$prizeRule.function}已发到你的优惠券列表中
                            <?php endif;?>
                            <?php endif;?>
                        </p>
                        <div class="open_log">
                            <p style="text-align: left;margin: 0;font-size: 16px;">&nbsp;&nbsp;拆盒名单：</p>
                            <table style="width: 100%;">
                                <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>手机号</th>
                                    <th>拆盒日期</th>
                                </tr>
                                </thead>
                                <tbody>
                                <foreach name="openLog" item="vo">
                                    <tr>
                                        <td><?php if($vo['nickName']):?>{$vo.nickName}<?php else:?>{$vo.realName}<?php endif;?></td>
                                        <td>{$vo.mobileNbr|substr=0,3}****{$vo.mobileNbr|substr=7,4}</td>
                                        <td><?php echo date('Y-m-d', $vo['openTime']);?></td>
                                    </tr>
                                </foreach>
                                <?php if(empty($openLog)):?>
                                <tr><td colspan="3">暂时还没有人给你拆礼盒！</td></tr>
                                <?php endif;?>
                                </tbody>
                            </table>
                        </div>
                        <div style="padding-bottom: 20px;">
                            <if condition="$userGiftInfo.timeDown eq 1 AND $userGiftInfo.openNbr lt $prizeRule.convertNbr">
                                <div style="margin-bottom: 5%;">距离免费吃大餐还剩下<br /><span id="time_down" style="font-size: 18px;color: rgb(113, 51, 1);">2天</span><br />赶紧邀请好友拆礼盒！</div>
                                <a href="hg://share?params={$param|urlencode}" class="external share">马上分享</a>
                            </if>
                            <if condition="$userGiftInfo.timeDown neq 1">
                                <?php if(empty($userGiftInfo['userGiftCode'])):?>
                                <div style="margin-bottom: 5%;">拆礼盒的时间已过，<br />
                                    请重新挑战赢取免费吃大餐机会
                                </div>
                                <a href="/Api/Browser/game?userCode={$userGiftInfo.userCode}&activityCode={$userGiftInfo.activityCode}" class="external share">再玩一次</a>
                                <?php endif;?>
                            </if>
                        </div>
                        <!--<p>已有{$count}人参与了此活动</p>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .navbar{background-color: rgb(182, 0, 12);}
    .navbar-inner .left img{width: 70%;height: auto;margin-left: -15%;}
    .page_view{background-image: url('/Public/img/game/open_log_bg.png');background-size: 100% 100%;background-repeat: no-repeat;text-align: center;}
    .page_view img:first-child{width: 55%;height: auto;margin-top: 37px;}
    .page_view .intro{text-align: center;padding: 18px 7%;font-size: 18px;color: #fff;font-family: cursive;}
    .open_log{margin: 21% 12% 5% 12%;background-image: url('/Public/img/game/open_log.png');background-size: 100% 100%;background-repeat: no-repeat;text-align: center;color: #000;padding: 10px;max-height: 250px;overflow-y: auto;}
    .share{background-color: rgb(246,185,2);padding: 2% 10%;color: rgb(222,106,12);border-radius: 25px;font-size: 18px;}
</style>
<script>
    var interval = 1000;
    function ShowCountDown(year,month,day,hour,minute,second,divname)
    {
        var now = new Date();
        var endDate = new Date(year, month-1, day, hour, minute, second);
        var leftTime=endDate.getTime()-now.getTime();
        var leftsecond = parseInt(leftTime/1000);
        var d=Math.floor(leftsecond/(60*60*24));
        var h=Math.floor((leftsecond-d*24*60*60)/3600);
        var m=Math.floor((leftsecond-d*24*60*60-h*3600)/60);
        var s=Math.floor(leftsecond-d*24*60*60-h*3600-m*60);
        var cc = document.getElementById(divname);
        if(cc){
            if((d == 0 && h == 0 && m == 0 && s== 0) || leftsecond < 0){
                cc.innerText = '';
            }else{
                if(d == 0 ){
                    if(h == 0){
                        if(m == 0){
                            cc.innerText = s+"秒";
                        }else if(m > 0){
                            cc.innerText = m+"分"+s+"秒";
                        }
                    }else if(h > 0){
                        cc.innerText = h+"小时"+m+"分"+s+"秒";
                    }
                }else if(d > 0 ){
                    cc.innerText = d+"天"+h+"小时"+m+"分"+s+"秒";
                }
            }
        }
    }

    var by = parseInt('{$userGiftInfo.bTime.y}');
    var bm = parseInt('{$userGiftInfo.bTime.m}');
    var bd = parseInt('{$userGiftInfo.bTime.d}');
    var bh = parseInt('{$userGiftInfo.bTime.h}');
    var bi = parseInt('{$userGiftInfo.bTime.i}');
    var bs = parseInt('{$userGiftInfo.bTime.s}');
    var int = window.setInterval(function(){
        ShowCountDown(by,bm,bd,bh,bi,bs,'time_down');
        var text = $('#time_down').text();
        if(text == ''){
            $('#time_down').parent().hide();
            window.clearInterval(int);
        }else{
            $('#time_down').parent().show();
        }
    }, interval);

</script>
