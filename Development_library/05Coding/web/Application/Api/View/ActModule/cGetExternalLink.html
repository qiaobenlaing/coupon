<layout name="layout_api" />
<!-- Views -->
<div class="views">
    <!-- Your main view, should have "view-main" class -->
    <div class="view view-main">
        <neq name="isShared" value="1">
            <div class="navbar shop-info-nav">
                <div class="navbar-inner">
                    <div class="left">
                        <a href="hg://backup" class="external"><img src="/Public/img/icon/backup.png" style="width: 48px;height: auto;margin-left: -7px;" /></a>
                    </div>
                    <div class="center"></div>
                    <div class="right">
                        <?php
                    $string = array(
                        'title'=> $activityInfo['activityName'],
                        'icon'=> 'http://api.huiquan.suanzi.cn'.$activityInfo['activityLogo'],
                        'content'=> $activityInfo['txtContent'],
                        'link'=> 'http://api.huiquan.suanzi.cn/Api/'.$activityInfo['webUrl'].$activityInfo['activityCode'].'&isShared=1',
                        );
                        $string = json_encode($string);
                        ?>
                        <a href="hg://share?params={$string|urlencode}" class="external"><img src="/Public/img/icon/share_white.png" style="width: 30px;height: auto;margin-right: 4px;" /></a>
                    </div>
                </div>
            </div>
        </neq>
        <!-- Pages container, because we use fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages">
            <!-- Page, "data-page" contains page name -->
            <div data-page="index" class="page">
                <!-- Scrollable page content -->
                <div class="page-content" style="position: relative;">
                    <div id="externalDiv">{$externalLinkHtml}</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/js/jweixin-1.0.0.js"></script>
<script>
    $(function() {
        var title = '{$activityInfo.activityName}';
        var icon = 'http://api.huiquan.suanzi.cn{$activityInfo.activityLogo}';
        var content = '{$activityInfo.txtContent}';
        var link = 'http://api.huiquan.suanzi.cn/Api/{$activityInfo.webUrl}{$activityInfo.activityCode}&isShared=1';
        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: '{$appId}', // 必填，公众号的唯一标识
            timestamp: '{$timestamp}', // 必填，生成签名的时间戳
            nonceStr: '{$nonceStr}', // 必填，生成签名的随机串
            signature: '{$signature}',// 必填，签名，见附录1
            jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });

        /**
         * 微信分享
         */
        wx.ready(function() {
            //分享到朋友圈
            wx.onMenuShareTimeline({
                title: title, // 分享标题
                link: link, // 分享链接
                imgUrl: icon, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
//                    alert("分享成功！");
                }
            });
            //分享给朋友
            wx.onMenuShareAppMessage({
                title: title, // 分享标题
                desc: content, // 分享描述
                link: link, // 分享链接
                imgUrl: icon, // 分享图标
//                type: '', // 分享类型,music、video或link，不填默认为link
//                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    // 用户确认分享后执行的回调函数
//                    alert("分享成功！");
                }
            });
            //分享到qq
            wx.onMenuShareQQ({
                title: title, // 分享标题
                desc: content, // 分享描述
                link: link, // 分享链接
                imgUrl: icon, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
//                    alert("分享成功！");
                }
            });
        });
    });
</script>