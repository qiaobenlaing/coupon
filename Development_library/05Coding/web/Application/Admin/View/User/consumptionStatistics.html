<layout name="layout_admin" />
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <form class="form-inline" method="get" action="#" id="data_search_form">
                <div class="form-group">
                    <label for="start-time">订单时间</label>
                    <div class="input-group date frm-date">
                        <input type="text" class="form_datetime form-control ipt-date-time-picker" name="startTime" value="{$get.startTime}" readonly placeholder="开始时间" id="start-time">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="end-time">至</label>
                    <div class="input-group date frm-date">
                        <input type="text" class="form_datetime form-control ipt-date-time-picker" name="endTime" value="{$get.endTime}" readonly placeholder="结束时间" id="end-time">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                    </div>
                </div>
                <button type="submit" class="btn btn-sm btn-primary">查询</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="consumption-amount"></div>
        </div>
        <div class="col-md-12">
            <div id="consumption-times"></div>
        </div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/js/highcharts/highcharts.js"></script>
<script>
    $(function(){
        // 初始化时间
        $('.frm-date').datetimepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayBtn: true,
            minView: 'month',
            pickerPosition: "bottom-left"
        });
        // 消费金额饼状图参数
        $('#consumption-amount').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: '用户消费金额统计'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>:{point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    },
                    showInLegend: true
                }
            },
            series: [{
                type: 'pie',
                name: '比例',
                data: {$jsonAmountData}
            }]
        });
        // 消费次数饼状图参数
        $('#consumption-times').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false
            },
            title: {
                text: '用户消费次数统计'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>:{point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    },
                    showInLegend: true
                }
            },
            series: [{
                type: 'pie',
                name: '区域比例',
                data: {$jsonTimesData}
            }]
        });
    });
</script>