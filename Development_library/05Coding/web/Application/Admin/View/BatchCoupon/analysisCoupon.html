<layout name="layout_admin" />
<div class="container-fluid coupon-analysis-wrap">
    <div class="row">
        <div class="col-md-12">
            <form class="form-inline" id="data_search_form" action="#" method="get">
                <div class="form-group">
                    <label>城市</label>
                    <select class="form-control input-sm" name="city">
                        <option value="">所有城市</option>
                        <foreach name="cityList" item="item">
                            <option value="{$item.name}" <eq name="get.city" value="$item.name">selected="selected"</eq>>{$item.name}</option>
                        </foreach>
                    </select>
                </div>
                <div class="form-group">
                    <label for="shop-name">商家名称</label>
                    <input type="text" class="form-control" id="shop-name" name="shopName" value="{$get.shopName}" placeholder="商家名称"/>
                </div>
                <div class="form-group">
                    <label for="start-date">券使用时间</label>
                    <div class="input-group date frm-date">
                        <input type="text" class="form-control ipt-date-time-picker" id="start-date" name="startDate" value="{$get.startDate}" readonly placeholder="开始时间"/>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="end-date">至</label>
                    <div class="input-group date frm-date">
                        <input type="text" class="form-control ipt-date-time-picker" name="endDate" value="{$get.endDate}" readonly placeholder="结束时间" id="end-date"/>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                    </div>
                </div>
                <div class="form-group">
                    <label>商户类型</label>
                    <select class="form-control input-sm" name="type">
                        <option value="" <eq name="get.type" value="">selected="selected"</eq>>所有商户</option>
                        <option value="0" <eq name="get.type" value="0">selected="selected"</eq>>未知</option>
                        <option value="1" <eq name="get.type" value="1">selected="selected"</eq>>美食</option>
                        <option value="2" <eq name="get.type" value="2">selected="selected"</eq>>咖啡</option>
                        <option value="3" <eq name="get.type" value="3">selected="selected"</eq>>健身</option>
                        <option value="4" <eq name="get.type" value="4">selected="selected"</eq>>娱乐</option>
                        <option value="5" <eq name="get.type" value="5">selected="selected"</eq>>服装</option>
                        <option value="6" <eq name="get.type" value="6">selected="selected"</eq>>其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>优惠券类型</label>
                    <select class="form-control input-sm" name="couponType">
                        <option value="">全部类型</option>
                        <foreach name="couponTypeList" item="vo">
                            <option value="{$vo.value}" <eq name="get.couponType" value="$vo.value">selected="selected"</eq>>{$vo.name}</option>
                        </foreach>
                    </select>
                </div>
                <input type="hidden" id="frm_ele_page" name="page" value="1" />
                <button type="submit" class="btn btn-sm btn-primary" id="search_form_submit_btn">查询</button>
            </form>
        </div>
    </div>
    <div class="row total-coupon-analysis-wrap">
        <div class="col-md-12">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                <tr>
                    <th>商户数量</th>
                    <th>发放数量</th>
                    <th>领用量</th>
                    <th>使用量</th>
                    <th>男性使用量</th>
                    <th>女性使用量</th>
                    <th>未知性别使用量</th>
                    <th>整体转化率</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td id="shop-count">{$data.shopCount}</td>
                    <td id="total-volume">{$data.totalVolume}</td>
                    <td id="take-count">{$data.takeCount}</td>
                    <td id="used-count">{$data.usedCount}</td>
                    <td id="m-used-count">{$data.mUsedCount|default=0}</td>
                    <td id="f-used-count">{$data.fUsedCount|default=0}</td>
                    <td id="u-used-count">{$data.uUsedCount|default=0}</td>
                    <td>{$data.rate}%</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <button type="button" class="btn btn-sm btn-default" id="btn-export-data">导出数据</button>
        </div>
        <div class="col-md-12" id="data_table_wrapper">
            <include file="Application/Admin/View/BatchCoupon/analysisCouponWidget.html"/>
        </div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/js/highcharts/highcharts.js"></script>
<script type="text/javascript">
    ;(function(){
        // 初始化券使用时间选择器
        $('.frm-date').datetimepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayBtn: true,
            minView: 'month',
            pickerPosition: "bottom-left"
        });
        // 倒数优惠券统计信息
        $('#btn-export-data').click(function(){
            var frm = $('#data_search_form');
            location.href = '/Admin/BatchCoupon/exportCouponStatistics?' + frm.serialize();
        });
    })();
</script>