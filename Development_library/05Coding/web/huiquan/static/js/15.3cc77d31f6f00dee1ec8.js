webpackJsonp([15],{235:function(o,t,e){function n(o){e(363)}var s=e(0)(e(334),e(390),n,null,null);o.exports=s.exports},334:function(o,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(13),s=e.n(n),i=e(6);t.default={data:function(){return{userCouponCode:this.$route.params.userCouponCode,checked:!1,coupon:{},shop:{},inputMoney:0,consumeMoney:"",couponMoney:0,realmoney:"",kOrder:"",Nodiscount:0,ablePay:!1,submitmoney:"",limitedNbr:"",userCount:"",couponCount:0,ableCount:""}},watch:{consumeMoney:function(){if(this.couponCount=0,"4"===this.coupon.couponType&&(this.consumeMoney=this.inputMoney-this.Nodiscount,this.consumeMoney>=this.coupon.availablePrice&&(this.realmoney=this.consumeMoney*(this.coupon.discountPercent/10)+this.Nodiscount,this.couponMoney=this.inputMoney-this.realmoney,this.realmoney=this.realmoney.toFixed(2),this.couponMoney=this.couponMoney.toFixed(2))),"3"===this.coupon.couponType){var o=this.consumeMoney/this.coupon.availablePrice;this.ableCount=parseInt(o),this.couponMoney=this.coupon.availablePrice*this.couponCount,this.realmoney=this.inputMoney-this.couponMoney}this.isToPay()},couponCount:function(){"3"===this.coupon.couponType&&(this.couponMoney=this.couponCount*this.coupon.insteadPrice,this.realmoney=this.inputMoney-this.couponMoney),this.isToPay()},Nodiscount:function(){this.consumeMoney=this.inputMoney-this.Nodiscount},inputMoney:function(){this.consumeMoney=this.inputMoney-this.Nodiscount}},computed:s()({},e.i(i.b)(["global","from"]),{realmoney:function(){return this.consumeMoney+this.Nodiscount}}),methods:{getCouponDetail:function(){var o=this,t=this;this.axios({method:"post",url:this.global.hftcomClient,data:'{"id":19,"jsonrpc":"2.0","method":"getUserCouponInfo","params":{"userCouponCode":"'+this.userCouponCode+'"}}',contentType:"application/json",dataType:"json"}).then(function(e){console.log(e),console.table(e.data.result[0],["index","value"]),t.coupon=e.data.result[0],"3"===o.coupon.couponType&&o.listUserPayInfo()})},checkNodiscount:function(){var o=!1,t=/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/;void 0!==this.Nodiscount&&""!==this.Nodiscount&&this.Nodiscount>=0&&this.Nodiscount<this.inputMoney&&t.test(this.Nodiscount)&&(o=!0),!0===o||(this.Nodiscount=0,this.$vux.toast.text("输入金额不合法","bottom"))},checkInputMoney:function(){console.log("开始检查");var o=!1,t=/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/;void 0!==this.inputMoney&&(console.log("1"),""!==this.inputMoney&&(console.log("2"),this.inputMoney>=0&&(console.log("3"),t.test(this.inputMoney)&&(console.log("4"),o=!0)))),!0===o||(this.inputMoney=0,this.$vux.toast.text("输入金额不合法","bottom"))},isToPay:function(){this.ablePay=!1,"4"===this.coupon.couponType&&this.consumeMoney>=this.coupon.availablePrice&&(this.ablePay=!0),"3"===this.coupon.couponType&&this.couponCount>=1&&this.consumeMoney>=this.coupon.availablePrice*this.couponCount&&(this.ablePay=!0)},cReduce:function(){this.couponCount>0&&this.couponCount--},cAdd:function(){this.couponCount>=0&&this.couponCount<this.limitedNbr&&this.couponCount<this.userCount&&this.couponCount<this.ableCount&&this.couponCount++},goBack:function(){this.$router.go(-1)},listUserPayInfo:function(){console.log(this.coupon);var o=this;this.axios({method:"post",url:this.$store.state.global.hftcomClient,data:'{"id":19,"jsonrpc":"2.0","method":"listUserPayInfo","params":{"userCode":"'+this.$store.state.userCode+'","shopCode":"'+this.coupon.shopCode+'","consumeAmount":"'+this.consumeMoney+'","batchCouponCode":"'+this.coupon.batchCouponCode+'"}}',dataType:"json"}).then(function(t){o.limitedNbr=t.data.result.coupon.couponInfo.limitedNbr,console.log(t.data.result.coupon),o.userCount=t.data.result.coupon.couponInfo.userCount,console.log(o.userCount)})},bankcardPay:function(){this.submitmoney=this.consumeMoney+this.Nodiscount;var o=this;"4"===this.coupon.couponType&&this.axios({method:"post",url:this.$store.state.global.hftcomClient,data:'{"id":19,"jsonrpc":"2.0","method":"bankcardPay","params":{"userCode":"'+this.$store.state.userCode+'","shopCode":"'+this.coupon.shopCode+'","orderAmount":"'+this.inputMoney+'","userCouponCode":"'+this.coupon.userCouponCode+'","platBonus":"","shopBonus":"","noDiscountPrice":"'+this.Nodiscount+'"}}',dataType:"json"}).then(function(t){console.log(t.data.result.code);var e=t.data.result.code;"80227"===e&&o.$vux.toast.text("优惠券当前不可用","bottom"),80220===e&&o.$vux.toast.text("优惠券已过期","bottom"),5e4===e&&(console.log("成功"),o.kOrder=t.data.result,o.kOrder.payType="PAYMONEY",o.$router.replace({path:"/gotopay",query:{order:o.kOrder}}))}),"3"===this.coupon.couponType&&this.axios({method:"post",url:this.$store.state.global.hftcomClient,data:'{"id":19,"jsonrpc":"2.0","method":"bankcardPayForAndroid","params":{"userCode":"'+this.$store.state.userCode+'","shopCode":"'+this.coupon.shopCode+'","orderAmount":"'+this.inputMoney+'","batchCouponCode":"'+this.coupon.batchCouponCode+'","nbrCoupon":"'+this.couponCount+'","platBonus":"","shopBonus":"","noDiscountPrice":"'+this.Nodiscount+'"}}',dataType:"json"}).then(function(t){console.log(t.data.result.code);var e=t.data.result.code;80227===e&&o.$vux.toast.text("优惠券当前不可用","bottom"),80220===e&&o.$vux.toast.text("优惠券已过期","bottom"),5e4===e&&(console.log("成功"),o.kOrder=t.data.result,o.kOrder.payType="PAYMONEY",o.$router.replace({path:"/gotopay",query:{order:o.kOrder}}))})}},created:function(){this.getCouponDetail()}}},363:function(o,t){},390:function(o,t){o.exports={render:function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",{attrs:{id:"ksubmit"}},[e("div",{attrs:{id:"header2fix"}},[e("header",{staticClass:"header"},[e("span",{directives:[{name:"show",rawName:"v-show",value:"weixin"!==o.from,expression:"from==='weixin'?false:true"}],staticClass:"header-item icon-back",on:{click:o.goBack}}),o._v(" "),e("span",{staticClass:"header-item"},[o._v("买单")])])]),o._v(" "),e("div",{staticClass:"shopname"},[e("span",{staticClass:"shopname1"},[o._v("商家名称")]),e("span",{staticClass:"shopname2"},[o._v(o._s(o.coupon.shopName))])]),o._v(" "),e("div",{staticClass:"consume"},[e("span",{staticClass:"consume1"},[o._v("消费金额")]),o._v(" "),e("span",{staticClass:"consume2"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:o.inputMoney,expression:"inputMoney",modifiers:{number:!0}}],staticClass:"consume3",attrs:{type:"text",maxlength:"8"},domProps:{value:o.inputMoney},on:{change:function(t){o.checkInputMoney()},input:function(t){t.target.composing||(o.inputMoney=o._n(t.target.value))},blur:function(t){o.$forceUpdate()}}}),o._v("元")])]),o._v(" "),e("div",{staticClass:"unpreferential"},[e("input",{directives:[{name:"model",rawName:"v-model",value:o.checked,expression:"checked"}],staticClass:"unpreferential1",attrs:{type:"checkbox",id:"checkbox"},domProps:{checked:Array.isArray(o.checked)?o._i(o.checked,null)>-1:o.checked},on:{change:function(t){var e=o.checked,n=t.target,s=!!n.checked;if(Array.isArray(e)){var i=o._i(e,null);n.checked?i<0&&(o.checked=e.concat([null])):i>-1&&(o.checked=e.slice(0,i).concat(e.slice(i+1)))}else o.checked=s}}}),o._v(" "),e("span",{staticClass:"unpreferential1"},[o._v("输入不参与优惠的金额(例如酒水、海鲜等等)")])]),o._v(" "),o.checked?e("div",{staticClass:"Nodiscount"},[e("span",{staticClass:"Nodiscount1"},[o._v("不参与优惠金额")]),o._v(" "),e("span",{staticClass:"Nodiscount2"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:o.Nodiscount,expression:"Nodiscount",modifiers:{number:!0}}],staticClass:"Nodiscount3",attrs:{type:"text",maxlength:"8"},domProps:{value:o.Nodiscount},on:{change:function(t){o.checkNodiscount()},input:function(t){t.target.composing||(o.Nodiscount=o._n(t.target.value))},blur:function(t){o.$forceUpdate()}}}),o._v("元")])]):o._e(),o._v(" "),e("div",{staticClass:"coupon"},["3"===o.coupon.couponType?e("span",{staticClass:"coupon1"},[o._v("抵扣券")]):o._e(),o._v(" "),"4"===o.coupon.couponType?e("span",{staticClass:"coupon1"},[o._v("折扣券")]):o._e(),o._v(" "),"3"===o.coupon.couponType?e("span",{staticClass:"coupon2"},[o._v("满"+o._s(o.coupon.availablePrice)+"减免"+o._s(o.coupon.insteadPrice)+"元")]):o._e(),o._v(" "),"4"===o.coupon.couponType?e("span",{staticClass:"coupon2"},[o._v("满"+o._s(o.coupon.availablePrice)+"打"+o._s(o.coupon.discountPercent)+"折")]):o._e(),o._v(" "),e("span",{staticClass:"coupon3"},[o._v("减免"+o._s(o.couponMoney)+"元")])]),o._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"3"===o.coupon.couponType,expression:"coupon.couponType==='3'"}],staticClass:"selectCoupon"},[e("span",{staticClass:"selectCoupon1"},[e("span",{staticClass:"selectCoupon11"},[o._v("最多可用"+o._s(o.limitedNbr)+"张")]),o._v(" "),e("span",{staticClass:"selectCoupon12"},[o._v("您拥有"+o._s(o.userCount)+"张")])]),o._v(" "),e("span",{staticClass:"selectCoupon2"},[e("div",{staticClass:"reduce",on:{click:function(t){o.cReduce()}}},[o._v("-")]),o._v("\n            "+o._s(o.couponCount)+"\n            "),e("div",{staticClass:"add",on:{click:function(t){o.cAdd()}}},[o._v("+")])])]),o._v(" "),e("div",{staticClass:"realpay"},[e("span",{staticClass:"realpay1"},[o._v("实际支付")]),e("span",{staticClass:"realpay2"},[o._v(o._s(o.realmoney)+"   元")])]),o._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:o.ablePay,expression:"ablePay"}],staticClass:"tonext",on:{click:function(t){o.bankcardPay()}}},[o._v("\n        下一步\n    ")]),o._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!o.ablePay,expression:"!ablePay"}],staticClass:"tonext2"},[o._v("\n        下一步\n    ")])])},staticRenderFns:[]}}});
//# sourceMappingURL=15.3cc77d31f6f00dee1ec8.js.map