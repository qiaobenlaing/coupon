webpackJsonp([17],{229:function(a,s,t){function i(a){t(347)}var d=t(0)(t(327),t(374),i,null,null);a.exports=d.exports},327:function(a,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t(13),d=t.n(i),e=t(6);s.default={data:function(){return{isadd:2,weixinCardList:[],cardInfo:{},signPakage:{},isadding:"",userCardCode:""}},computed:d()({},t.i(e.b)(["global","userCode","isLogin"])),methods:{goBack:function(){this.$router.go(-1)},showcard:function(a){var s=this;this.isadd=a,this.axios({method:"post",url:this.global.hftcomWeixinCard,data:'{"id":29,"jsonrpc":"2.0","method":"listWeixinCard","params":{"userCode":"'+this.userCode+'","inWeixinCard":"'+a+'"}}'}).then(function(a){console.log(a.data.result),s.weixinCardList=a.data.result})},addvipcard:function(a){var s=this;this.isadding=a,this.axios({method:"post",url:this.global.hftcomWeixinCard,data:'{"id":29,"jsonrpc":"2.0","method":"addWeixinCard","params":{"userCode":"'+this.userCode+'","shopCode":"'+a+'"}}'}).then(function(a){console.log(a.data),""===a.data.result.signPakage||void 0===a.data.result.signPakage?s.$vux.toast.text("数据请求错误，请稍后重试","bottom"):(s.cardInfo=a.data.result.cardInfo,s.signPakage=a.data.result.signPakage,s.userCardCode=a.data.result.userCardCode,s.addcardtoweixin()),s.isadding=""})},updateUserWeixinCard:function(){var a=this;this.axios({method:"post",url:this.global.hftcomWeixinCard,data:'{"id":29,"jsonrpc":"2.0","method":"updateUserWeixinCard","params":{"userCardCode":"'+this.userCardCode+'"}}'}).then(function(s){a.$router.go(0),console.log(s.data.result)})},addcardtoweixin:function(){var a=this;wx.config({debug:!1,appId:this.signPakage.appid,timestamp:this.signPakage.timestamp,nonceStr:this.signPakage.noncestr,signature:this.signPakage.signature,jsApiList:["addCard"]}),wx.ready(function(){wx.addCard({cardList:[{code:a.cardInfo.code,cardId:a.cardInfo.card_id,cardExt:'{"code":"'+a.cardInfo.code+'","timestamp":"'+a.cardInfo.timestamp+'","signature":"'+a.cardInfo.signature+'","nonce_str":"'+a.cardInfo.nonce_str+'"}'}],success:function(s){a.$vux.toast.text("已添加卡券","bottom"),a.updateUserWeixinCard()},cancel:function(s){a.$vux.toast.text("取消添加","bottom")}})}),wx.error(function(a){console.log("err",a)})}},created:function(){this.showcard(2)}}},347:function(a,s){},374:function(a,s){a.exports={render:function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("div",{attrs:{id:"myvipcard"}},[t("header",{staticClass:"header"},[t("span",{staticClass:"header-item icon-back",on:{click:a.goBack}}),a._v(" "),t("div",{staticClass:"header-item"},[t("span",{staticClass:"isadd add",class:{active:2===a.isadd},on:{click:function(s){a.showcard(2)}}},[a._v("未添加")]),a._v(" "),t("span",{staticClass:"isadd added",class:{active:1===a.isadd},on:{click:function(s){a.showcard(1)}}},[a._v("已添加")])])]),a._v(" "),a._l(a.weixinCardList,function(s){return t("div",{staticClass:"cardwrapper"},[t("div",{staticClass:"cardback"},[t("img",{attrs:{src:a.global.hftcom+s.logoUrl,alt:""}})]),a._v(" "),t("div",{staticClass:"cardbackcolor",class:{cardbacksilvery:"银卡"===s.cardName,cardbackgold:"金卡"===s.cardName}}),a._v(" "),t("div",{staticClass:"logo"},[t("img",{attrs:{src:a.global.hftcom+s.logoUrl,alt:""}})]),a._v(" "),t("div",{staticClass:"cardinfo"},[t("div",{staticClass:"shopname"},[a._v(a._s(s.shopName))]),a._v(" "),t("div",{staticClass:"carddetail"},[a._v(a._s(s.cardName)+" "),t("span",{staticClass:"point"},[a._v("积分："+a._s(s.point))])])]),a._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:2===a.isadd,expression:"isadd ===2"}],staticClass:"addbtn",on:{click:function(t){a.addvipcard(s.shopCode)}}},[t("span",{directives:[{name:"show",rawName:"v-show",value:a.isadding!==s.shopCode,expression:"isadding!==index.shopCode"}],staticClass:"text"},[a._v("添加")]),a._v(" "),t("transition",{attrs:{name:"rotate"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:a.isadding===s.shopCode,expression:"isadding===index.shopCode"}],staticClass:"icon-spinner8"})])],1)])})],2)},staticRenderFns:[]}}});
//# sourceMappingURL=17.cae2ba2b7fb3adf8e71b.js.map